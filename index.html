<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hong Kong Fui Yong Hakka — Study</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <div class="masthead">
        <h1>Hong Kong Fui Yong Hakka — Study</h1>
        <div class="kicker">
          <span>Flashcards</span>
          <span>Multiple Choice</span>
          <span>Typing</span>
        </div>
      </div>
      <div class="row" style="margin-left: auto;">
        <div class="pill" id="streak-session">Session: 0</div>
        <div class="pill" id="streak-life">Lifetime: 0</div>
        <button id="theme-toggle" class="btn" title="Toggle dark mode">Dark Mode</button>
        <button id="help-btn" class="btn" title="How to use">Help</button>
      </div>
    </header>

    <div class="card">
      <div class="tabbar" role="tablist" aria-label="Modes">
        <button role="tab" id="tab-flash" aria-selected="true" data-panel="flash">Flashcards</button>
        <button role="tab" id="tab-mc" data-panel="mc">Multiple Choice</button>
        <button role="tab" id="tab-typing" data-panel="typing">Typing</button>
        <button role="tab" id="tab-review" data-panel="review">Reviewing</button>
        <button role="tab" id="tab-stats" data-panel="stats">Vocabulary</button>
        <button role="tab" id="tab-manage" data-panel="manage">Import/Export</button>
      </div>

      <!-- FLASHCARDS -->
      <section class="tabpanel" id="panel-flash" aria-hidden="false" aria-labelledby="tab-flash">
        <div class="big" id="flash-front"></div>
        <div class="big" id="flash-back" style="display:none;margin-top:10px;opacity:.98"></div>
        <div class="row" style="justify-content:center;margin-top:14px">
          <button id="btn-show" class="btn">Show</button>
          <button id="btn-again" class="btn bad" style="display:none">Again</button>
          <button id="btn-hard" class="btn warn" style="display:none">Hard</button>
          <button id="btn-good" class="btn" style="display:none">Good</button>
          <button id="btn-easy" class="btn good" style="display:none">Easy</button>
          <button id="flash-next" class="btn" style="display:none;margin-top:10px">Next</button>
        </div>
        <div class="small" style="text-align:center;margin-top:8px"><span id="queue-info">0 due</span></div>
      </section>

      <!-- MULTIPLE CHOICE -->
      <section class="tabpanel" id="panel-mc" aria-hidden="true" aria-labelledby="tab-mc">
        <div id="mc-question" class="big"></div>
        <div id="mc-options" class="row" style="margin-top:16px;justify-content:center;flex-wrap:wrap"></div>
        <div id="mc-feedback" class="small" style="margin-top:8px;text-align:center"></div>
        <button id="mc-next" class="btn" style="display:none;margin-top:10px">Next</button>
      </section>

      <!-- TYPING -->
      <section class="tabpanel" id="panel-typing" aria-hidden="true" aria-labelledby="tab-typing">
        <div class="row" style="justify-content:center;gap:8px;margin-bottom:8px">
          <label for="typing-mode" class="small">Answer in:</label>
          <select id="typing-mode">
            <option value="eng" selected>English</option>
            <option value="mandarin">Mandarin (普通中文)</option>
            <option value="pron">Hakka pronunciation</option>
          </select>
        </div>
        <div id="typing-question" class="big"></div>
        <div class="row" style="margin-top:12px;justify-content:center">
          <input id="typing-input" type="text" placeholder="Type the English and press Enter" style="min-width:340px" />
        </div>
        <div id="typing-feedback" class="small" style="margin-top:6px;text-align:center"></div>
        <button id="typing-next" class="btn" style="display:none;margin-top:10px">Next</button>
      </section>

      <!-- REVIEWING -->
      <section class="tabpanel" id="panel-review" aria-hidden="true" aria-labelledby="tab-review">
        <div class="row" style="gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:8px">
          <div class="pill">Learned: <span id="rev-learned-count">0</span></div>
            <div class="pill">Mistakes: <span id="rev-mistake-count">0</span></div>
            <div class="pill">Due Today: <span id="rev-due-count">0</span></div>
            <label class="small" style="margin-left:8px">Show:</label>
            <select id="rev-filter">
              <option value="learned" selected>Learned</option>
              <option value="mistakes">Mistakes</option>
              <option value="due">Due Today</option>
            </select>
        </div>
        <div id="rev-list" class="card" style="padding:12px"></div>
      </section>

      <!-- VOCAB / STATS -->
      <section class="tabpanel" id="panel-stats" aria-hidden="true" aria-labelledby="tab-stats">
        <div class="row" style="gap:24px;flex-wrap:wrap">
          <div class="pill">Due: <span id="stat-due">0</span></div>
          <div class="pill">New: <span id="stat-new">0</span></div>
          <div class="pill">Review: <span id="stat-review">0</span></div>
          <div class="pill">Total: <span id="stat-total">0</span></div>
        </div>
        <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:12px">
          <div class="pill stat-pill">Session Vocab: <span id="vocab-session">0</span></div>
          <div class="pill stat-pill">Lifetime Vocab: <span id="vocab-life">0</span></div>
        </div>
        <div class="row" style="gap:12px;flex-wrap:wrap;margin:16px 0 8px">
          <input id="vocab-search" type="text" placeholder="Search English / Hakka pronunciation / 普通中文 / 客家汉字" style="flex:1;min-width:260px" />
        </div>
        <div id="vocab-list" class="card" style="padding:12px"></div>
      </section>

      <!-- IMPORT/EXPORT -->
      <section class="tabpanel" id="panel-manage" aria-hidden="true" aria-labelledby="tab-manage">
        <div class="row" style="gap:12px;align-items:flex-start;flex-wrap:wrap">
          <div style="flex:1 1 360px" class="card">
            <h3>Import CSV</h3>
            <div class="small">CSV header must be <span class="mono">普通中文,客家汉字,Hakka Pronunciation,English Definition</span></div>
            <textarea id="csv-text" rows="6" placeholder="普通中文,客家汉字,Hakka Pronunciation,English Definition&#10;昨天,晡晡日,cam2 min2 ngit5,Yesterday" style="width:100%"></textarea>
            <div class="row" style="margin-top:10px">
              <input id="csv-file" type="file" accept=".csv" />
              <button id="import-csv" class="btn">Import</button>
            </div>
          </div>
          <div style="flex:1 1 300px" class="card">
            <h3>Backup / Restore</h3>
            <div class="row">
              <button id="export-json" class="btn">Export Progress</button>
              <input id="import-json-file" type="file" accept="application/json" />
              <button id="import-json" class="btn">Import Progress</button>
            </div>
            <div class="small">Progress is saved in your browser (localStorage).</div>
          </div>
        </div>
      </section>
    </div>

    <footer class="small" style="margin-top:14px;opacity:.8">Stores your "progress" in your browser. Nothing is stored online.</footer>
  </div>

  <!-- Help modal -->
  <div id="help-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="help-title">
      <div class="modal-backdrop"></div>
      <div class="modal-content" role="document">
        <button class="modal-close" aria-label="Close">×</button>
        <h2 id="help-title" style="margin-top:0">How this site works</h2>

        <div class="small" style="margin-bottom:14px; color:var(--muted)">
          Cards load from your CSV (default: <code>Hakka Vocabulary.csv</code>). Progress is saved locally in your browser.
        </div>

        <h3>Flashcards</h3>
        <ul class="small">
          <li>Press <strong>Show</strong> to reveal the back. Audio auto-plays; use ▶ to replay.</li>
          <li>Rate with <strong>Again / Hard / Good / Easy</strong> to schedule with SRS (like Anki).</li>
          <li>Tone colors: ① ˊ red, ②   blue, ③   green, ④  ˋ  purple, ⑤   orange, ⑥ ˋ yellow;</li>
          <li>The pinyim shows diacritics</li>
        </ul>

        <h3>Multiple Choice</h3>
        <ul class="small">
          <li>Choose the correct English (or Mandarin if available). After selection, the back replaces the front, audio auto-plays.</li>
          <li>Click <strong>Next</strong> to move on. Correct answers increment your streak.</li>
        </ul>

        <h3>Typing</h3>
        <ul class="small">
          <li>Select answer mode: <strong>English / Mandarin (use Chinese characters) / Hakka pronunciation (use tone number notation)</strong>.</li>
          <li>Type your answer and press <strong>Enter</strong>. The back replaces the front; ▶ replays audio.</li>
          <li>Click <strong>Next</strong> to proceed.</li>
        </ul>

        <h3>Reviewing</h3>
        <ul class="small">
          <li>Filter by <strong>Due Today</strong>, <strong>Learned</strong>, or <strong>Mistakes</strong>.</li>
          <li>Table shows 普通中文, 客家汉字 (tone-colored), Hakka pronunciation (with ▶), English, ✓/✗, and “Due in”.</li>
        </ul>

        <h3>Vocabulary</h3>
        <ul class="small">
          <li>Search across <strong>English / Hakka pronunciation / 普通中文 / 客家汉字</strong>.</li>
          <li>Each row includes a ▶ button for TTS.</li>
        </ul>

        <h3>Import / Export</h3>
        <ul class="small">
          <li>Import CSV using header: <code>普通中文,客家汉字,Hakka Pronunciation,English Definition</code>.</li>
          <li>Backup/restore your local progress via JSON.</li>
        </ul>

        <h3>Dark Mode & Streaks</h3>
        <ul class="small">
          <li>Toggle light/dark via the <strong>Dark Mode</strong> button.</li>
          <li>Session/Lifetime counts mirror your correct answers; SRS due counts appear under <strong>Vocabulary</strong>.</li>
        </ul>

        <hr style="margin:16px 0; border:none; border-top:1px solid var(--line)" />

          <h2 style="margin:0 0 10px; font-weight:800;">References</h2>

          <p style="margin:0 0 8px; color:var(--muted);">
            <strong>Source Material</strong><br />
            「香港客家话研究」 by <strong>劉鎮發 (liu2 zin3 fat5)</strong>  – provides the tone and language basis for the diacritic conversion.
          </p>

          <p style="margin:10px 0 6px;"><strong>Fui Yong Hakka TTS Model &amp; API</strong>:</p>
          <ul style="margin:0; padding-left:18px; color:var(--muted)">
            <li>
              <strong>Hong Kong Hakka TTS</strong>:
              <a href="https://hkilang.github.io/TTS/" target="_blank" rel="noopener">https://hkilang.github.io/TTS/</a>
            </li>
            <li>
              <strong>Source Code</strong>:
              <a href="https://github.com/hkilang/TTS/tree/main" target="_blank" rel="noopener">https://github.com/hkilang/TTS/tree/main</a>
            </li>
            <li>
              <strong>TTS API</strong>:
              <a href="https://github.com/hkilang/TTS-API/tree/main" target="_blank" rel="noopener">https://github.com/hkilang/TTS-API/tree/main</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

  <script src="app.js" defer></script>
</body>
</html>